<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DOS_DETECTOR: src/_monitor/md01_test.bpf.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">DOS_DETECTOR<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">CPU exhaustion dos attack detection with berkeley packet filter</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_9897c981b97b1a02ddd2e9a038789b95.html">_monitor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">md01_test.bpf.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;vmlinux.h&quot;</code><br />
<code>#include &lt;bpf/bpf_helpers.h&gt;</code><br />
<code>#include &lt;bpf/bpf_tracing.h&gt;</code><br />
<code>#include &lt;bpf/bpf_core_read.h&gt;</code><br />
<code>#include &quot;<a class="el" href="md01__test_8h_source.html">md01_test.h</a>&quot;</code><br />
</div>
<p><a href="md01__test_8bpf_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aede1f5f3a43fd0b9e5a389baf367df5f"><td class="memItemLeft" align="right" valign="top">char LICENSE[]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#aede1f5f3a43fd0b9e5a389baf367df5f">SEC</a> (&quot;license&quot;)</td></tr>
<tr class="separator:aede1f5f3a43fd0b9e5a389baf367df5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a808534f7d13e21b9c882f76b8c0194fc"><td class="memItemLeft" >struct {&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a808534f7d13e21b9c882f76b8c0194fc"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a808534f7d13e21b9c882f76b8c0194fc">SEC</a> (&quot;.maps&quot;)&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a808534f7d13e21b9c882f76b8c0194fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4af39ef08900aec86b3f88f75aedc6e2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a4af39ef08900aec86b3f88f75aedc6e2">__uint</a> (type, BPF_MAP_TYPE_HASH)</td></tr>
<tr class="separator:a4af39ef08900aec86b3f88f75aedc6e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0478e3b0cb8f74ba4578718bde938b39"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a0478e3b0cb8f74ba4578718bde938b39">__uint</a> (max_entries, 8192)</td></tr>
<tr class="separator:a0478e3b0cb8f74ba4578718bde938b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62635c980aa8cab3aa284175166f142f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a62635c980aa8cab3aa284175166f142f">__type</a> (key, pid_t)</td></tr>
<tr class="separator:a62635c980aa8cab3aa284175166f142f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae225703dfea010801f8bd4a85b56fac9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#ae225703dfea010801f8bd4a85b56fac9">__type</a> (value, u64)</td></tr>
<tr class="separator:ae225703dfea010801f8bd4a85b56fac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d6e774307df1740ef4dbd9172a164a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a30d6e774307df1740ef4dbd9172a164a">__uint</a> (type, BPF_MAP_TYPE_RINGBUF)</td></tr>
<tr class="separator:a30d6e774307df1740ef4dbd9172a164a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a426c062cff7560bd875590fc1cac6237"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a426c062cff7560bd875590fc1cac6237">__uint</a> (max_entries, 256 *1024)</td></tr>
<tr class="separator:a426c062cff7560bd875590fc1cac6237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33d8306c21e04f61a95782c96bff1ec0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a33d8306c21e04f61a95782c96bff1ec0">handle_exec</a> (struct trace_event_raw_sched_process_exec *ctx)</td></tr>
<tr class="separator:a33d8306c21e04f61a95782c96bff1ec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7664c2099745e18ea926bc1722de3ee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#aa7664c2099745e18ea926bc1722de3ee">handle_exit</a> (struct trace_event_raw_sched_process_template *ctx)</td></tr>
<tr class="separator:aa7664c2099745e18ea926bc1722de3ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a898ec4fe28907d4b2ba5708db2553dd6"><td class="memItemLeft" align="right" valign="top">const volatile unsigned long long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a> = 0</td></tr>
<tr class="separator:a898ec4fe28907d4b2ba5708db2553dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a62635c980aa8cab3aa284175166f142f" name="a62635c980aa8cab3aa284175166f142f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62635c980aa8cab3aa284175166f142f">&#9670;&#160;</a></span>__type() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@0::__type </td>
          <td>(</td>
          <td class="paramtype">key&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae225703dfea010801f8bd4a85b56fac9" name="ae225703dfea010801f8bd4a85b56fac9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae225703dfea010801f8bd4a85b56fac9">&#9670;&#160;</a></span>__type() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@0::__type </td>
          <td>(</td>
          <td class="paramtype">value&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a426c062cff7560bd875590fc1cac6237" name="a426c062cff7560bd875590fc1cac6237"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a426c062cff7560bd875590fc1cac6237">&#9670;&#160;</a></span>__uint() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@1::__uint </td>
          <td>(</td>
          <td class="paramtype">max_entries&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">256 *&#160;</td>
          <td class="paramname"><em>1024</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0478e3b0cb8f74ba4578718bde938b39" name="a0478e3b0cb8f74ba4578718bde938b39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0478e3b0cb8f74ba4578718bde938b39">&#9670;&#160;</a></span>__uint() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@2::__uint </td>
          <td>(</td>
          <td class="paramtype">max_entries&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">8192&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4af39ef08900aec86b3f88f75aedc6e2" name="a4af39ef08900aec86b3f88f75aedc6e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4af39ef08900aec86b3f88f75aedc6e2">&#9670;&#160;</a></span>__uint() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@2::__uint </td>
          <td>(</td>
          <td class="paramtype">type&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BPF_MAP_TYPE_HASH&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a30d6e774307df1740ef4dbd9172a164a" name="a30d6e774307df1740ef4dbd9172a164a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30d6e774307df1740ef4dbd9172a164a">&#9670;&#160;</a></span>__uint() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">@1::__uint </td>
          <td>(</td>
          <td class="paramtype">type&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BPF_MAP_TYPE_RINGBUF&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a33d8306c21e04f61a95782c96bff1ec0" name="a33d8306c21e04f61a95782c96bff1ec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33d8306c21e04f61a95782c96bff1ec0">&#9670;&#160;</a></span>handle_exec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_exec </td>
          <td>(</td>
          <td class="paramtype">struct trace_event_raw_sched_process_exec *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="md01__test_8bpf_8c_source.html#l00025">25</a> of file <a class="el" href="md01__test_8bpf_8c_source.html">md01_test.bpf.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   26</span>{</div>
<div class="line"><span class="lineno">   27</span>    <span class="keyword">struct </span>task_struct *task;</div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordtype">unsigned</span> fname_off;</div>
<div class="line"><span class="lineno">   29</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structevent.html">event</a> *e;</div>
<div class="line"><span class="lineno">   30</span>    pid_t <a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a>;</div>
<div class="line"><span class="lineno">   31</span>    u64 ts;</div>
<div class="line"><span class="lineno">   32</span> </div>
<div class="line"><span class="lineno">   33</span>    <span class="comment">/* remember time exec() was executed for this PID */</span></div>
<div class="line"><span class="lineno">   34</span>    <a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a> = bpf_get_current_pid_tgid() &gt;&gt; 32;</div>
<div class="line"><span class="lineno">   35</span>    ts = bpf_ktime_get_ns();</div>
<div class="line"><span class="lineno">   36</span>    bpf_map_update_elem(&amp;exec_start, &amp;<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a>, &amp;ts, BPF_ANY);</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">/* don&#39;t emit exec events when minimum duration is specified */</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a>)</div>
<div class="line"><span class="lineno">   40</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span>    <span class="comment">/* reserve sample from BPF ringbuf */</span></div>
<div class="line"><span class="lineno">   43</span>    e = bpf_ringbuf_reserve(&amp;rb, <span class="keyword">sizeof</span>(*e), 0);</div>
<div class="line"><span class="lineno">   44</span>    <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno">   45</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="comment">/* fill out the sample with data */</span></div>
<div class="line"><span class="lineno">   48</span>    task = (<span class="keyword">struct </span>task_struct *)bpf_get_current_task();</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>    e-&gt;<a class="code hl_variable" href="structevent.html#ac334e14ef8cb3c12f5a7d0b32b49d137">exit_event</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   51</span>    e-&gt;<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a> = pid;</div>
<div class="line"><span class="lineno">   52</span>    e-&gt;<a class="code hl_variable" href="structevent.html#aa89478045b20dd554ee80151136cbcb0">ppid</a> = BPF_CORE_READ(task, real_parent, tgid);</div>
<div class="line"><span class="lineno">   53</span>    bpf_get_current_comm(&amp;e-&gt;<a class="code hl_variable" href="structevent.html#a60db55f80d8f2b7649133ad0e37d1392">comm</a>, <span class="keyword">sizeof</span>(e-&gt;<a class="code hl_variable" href="structevent.html#a60db55f80d8f2b7649133ad0e37d1392">comm</a>));</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    fname_off = ctx-&gt;__data_loc_filename &amp; 0xFFFF;</div>
<div class="line"><span class="lineno">   56</span>    bpf_probe_read_str(&amp;e-&gt;<a class="code hl_variable" href="structevent.html#acd81845e86736ec19fdb512a0952801d">filename</a>, <span class="keyword">sizeof</span>(e-&gt;<a class="code hl_variable" href="structevent.html#acd81845e86736ec19fdb512a0952801d">filename</a>), (<span class="keywordtype">void</span> *)ctx + fname_off);</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>    <span class="comment">/* successfully submit it to user-space for post-processing */</span></div>
<div class="line"><span class="lineno">   59</span>    bpf_ringbuf_submit(e, 0);</div>
<div class="line"><span class="lineno">   60</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   61</span>}</div>
<div class="ttc" id="amd01__test_8bpf_8c_html_a898ec4fe28907d4b2ba5708db2553dd6"><div class="ttname"><a href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a></div><div class="ttdeci">const volatile unsigned long long min_duration_ns</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8bpf_8c_source.html#l00022">md01_test.bpf.c:22</a></div></div>
<div class="ttc" id="astructevent_html"><div class="ttname"><a href="structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00008">md01_test.h:8</a></div></div>
<div class="ttc" id="astructevent_html_a17dfdcf290911e8c058e8bd725543c01"><div class="ttname"><a href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">event::pid</a></div><div class="ttdeci">int pid</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00009">md01_test.h:9</a></div></div>
<div class="ttc" id="astructevent_html_a60db55f80d8f2b7649133ad0e37d1392"><div class="ttname"><a href="structevent.html#a60db55f80d8f2b7649133ad0e37d1392">event::comm</a></div><div class="ttdeci">char comm[TASK_COMM_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00013">md01_test.h:13</a></div></div>
<div class="ttc" id="astructevent_html_aa89478045b20dd554ee80151136cbcb0"><div class="ttname"><a href="structevent.html#aa89478045b20dd554ee80151136cbcb0">event::ppid</a></div><div class="ttdeci">int ppid</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00010">md01_test.h:10</a></div></div>
<div class="ttc" id="astructevent_html_ac334e14ef8cb3c12f5a7d0b32b49d137"><div class="ttname"><a href="structevent.html#ac334e14ef8cb3c12f5a7d0b32b49d137">event::exit_event</a></div><div class="ttdeci">bool exit_event</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00015">md01_test.h:15</a></div></div>
<div class="ttc" id="astructevent_html_acd81845e86736ec19fdb512a0952801d"><div class="ttname"><a href="structevent.html#acd81845e86736ec19fdb512a0952801d">event::filename</a></div><div class="ttdeci">char filename[MAX_FILENAME_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00014">md01_test.h:14</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa7664c2099745e18ea926bc1722de3ee" name="aa7664c2099745e18ea926bc1722de3ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7664c2099745e18ea926bc1722de3ee">&#9670;&#160;</a></span>handle_exit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_exit </td>
          <td>(</td>
          <td class="paramtype">struct trace_event_raw_sched_process_template *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="md01__test_8bpf_8c_source.html#l00064">64</a> of file <a class="el" href="md01__test_8bpf_8c_source.html">md01_test.bpf.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   65</span>{</div>
<div class="line"><span class="lineno">   66</span>    <span class="keyword">struct </span>task_struct *task;</div>
<div class="line"><span class="lineno">   67</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structevent.html">event</a> *e;</div>
<div class="line"><span class="lineno">   68</span>    pid_t <a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a>, tid;</div>
<div class="line"><span class="lineno">   69</span>    u64 id, ts, *start_ts, <a class="code hl_variable" href="structevent.html#a8b237a49c60868f7ac946af7dbe823f2">duration_ns</a> = 0;</div>
<div class="line"><span class="lineno">   70</span>    </div>
<div class="line"><span class="lineno">   71</span>    <span class="comment">/* get PID and TID of exiting thread/process */</span></div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordtype">id</span> = bpf_get_current_pid_tgid();</div>
<div class="line"><span class="lineno">   73</span>    <a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a> = <span class="keywordtype">id</span> &gt;&gt; 32;</div>
<div class="line"><span class="lineno">   74</span>    tid = (u32)<span class="keywordtype">id</span>;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment">/* ignore thread exits */</span></div>
<div class="line"><span class="lineno">   77</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a> != tid)</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">/* if we recorded start of the process, calculate lifetime duration */</span></div>
<div class="line"><span class="lineno">   81</span>    start_ts = bpf_map_lookup_elem(&amp;exec_start, &amp;<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a>);</div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordflow">if</span> (start_ts)</div>
<div class="line"><span class="lineno">   83</span>        <a class="code hl_variable" href="structevent.html#a8b237a49c60868f7ac946af7dbe823f2">duration_ns</a> = bpf_ktime_get_ns() - *start_ts;</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a>)</div>
<div class="line"><span class="lineno">   85</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   86</span>    bpf_map_delete_elem(&amp;exec_start, &amp;<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a>);</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>    <span class="comment">/* if process didn&#39;t live long enough, return early */</span></div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a> &amp;&amp; <a class="code hl_variable" href="structevent.html#a8b237a49c60868f7ac946af7dbe823f2">duration_ns</a> &lt; <a class="code hl_variable" href="md01__test_8bpf_8c.html#a898ec4fe28907d4b2ba5708db2553dd6">min_duration_ns</a>)</div>
<div class="line"><span class="lineno">   90</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>    <span class="comment">/* reserve sample from BPF ringbuf */</span></div>
<div class="line"><span class="lineno">   93</span>    e = bpf_ringbuf_reserve(&amp;rb, <span class="keyword">sizeof</span>(*e), 0);</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">if</span> (!e)</div>
<div class="line"><span class="lineno">   95</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>    <span class="comment">/* fill out the sample with data */</span></div>
<div class="line"><span class="lineno">   98</span>    task = (<span class="keyword">struct </span>task_struct *)bpf_get_current_task();</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>    e-&gt;<a class="code hl_variable" href="structevent.html#ac334e14ef8cb3c12f5a7d0b32b49d137">exit_event</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  101</span>    e-&gt;<a class="code hl_variable" href="structevent.html#a8b237a49c60868f7ac946af7dbe823f2">duration_ns</a> = duration_ns;</div>
<div class="line"><span class="lineno">  102</span>    e-&gt;<a class="code hl_variable" href="structevent.html#a17dfdcf290911e8c058e8bd725543c01">pid</a> = pid;</div>
<div class="line"><span class="lineno">  103</span>    e-&gt;<a class="code hl_variable" href="structevent.html#aa89478045b20dd554ee80151136cbcb0">ppid</a> = BPF_CORE_READ(task, real_parent, tgid);</div>
<div class="line"><span class="lineno">  104</span>    e-&gt;<a class="code hl_variable" href="structevent.html#a9ce4d7922fdeff0082218eb418e937b1">exit_code</a> = (BPF_CORE_READ(task, exit_code) &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  105</span>    bpf_get_current_comm(&amp;e-&gt;<a class="code hl_variable" href="structevent.html#a60db55f80d8f2b7649133ad0e37d1392">comm</a>, <span class="keyword">sizeof</span>(e-&gt;<a class="code hl_variable" href="structevent.html#a60db55f80d8f2b7649133ad0e37d1392">comm</a>));</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    <span class="comment">/* send data to user-space for post-processing */</span></div>
<div class="line"><span class="lineno">  108</span>    bpf_ringbuf_submit(e, 0);</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  110</span>}</div>
<div class="ttc" id="astructevent_html_a8b237a49c60868f7ac946af7dbe823f2"><div class="ttname"><a href="structevent.html#a8b237a49c60868f7ac946af7dbe823f2">event::duration_ns</a></div><div class="ttdeci">unsigned long long duration_ns</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00012">md01_test.h:12</a></div></div>
<div class="ttc" id="astructevent_html_a9ce4d7922fdeff0082218eb418e937b1"><div class="ttname"><a href="structevent.html#a9ce4d7922fdeff0082218eb418e937b1">event::exit_code</a></div><div class="ttdeci">unsigned exit_code</div><div class="ttdef"><b>Definition:</b> <a href="md01__test_8h_source.html#l00011">md01_test.h:11</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a808534f7d13e21b9c882f76b8c0194fc" name="a808534f7d13e21b9c882f76b8c0194fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a808534f7d13e21b9c882f76b8c0194fc">&#9670;&#160;</a></span>SEC() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct @1 SEC </td>
          <td>(</td>
          <td class="paramtype">&quot;.maps&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aede1f5f3a43fd0b9e5a389baf367df5f" name="aede1f5f3a43fd0b9e5a389baf367df5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aede1f5f3a43fd0b9e5a389baf367df5f">&#9670;&#160;</a></span>SEC() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char LICENSE[] SEC </td>
          <td>(</td>
          <td class="paramtype">&quot;license&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a898ec4fe28907d4b2ba5708db2553dd6" name="a898ec4fe28907d4b2ba5708db2553dd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a898ec4fe28907d4b2ba5708db2553dd6">&#9670;&#160;</a></span>min_duration_ns</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const volatile unsigned long long min_duration_ns = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="md01__test_8bpf_8c_source.html#l00022">22</a> of file <a class="el" href="md01__test_8bpf_8c_source.html">md01_test.bpf.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
